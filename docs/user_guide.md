Copyright 2024, Battelle Energy Alliance, LLC, ALL RIGHTS RESERVED
### Notes and Definitions for Users in Kugelpy

1. **default values** - Some tests require the initial hard-coded parameters to remain unchanged. If any tests fail the parameter values in the code should be compared to the default values provided in `user_variables.md` or `other_variables.md`.
2. **'proper core'** - refers to the the region of the core containing explicitly modeled pebbles excluding the upper cone and lower conus. In simpler terms, any pebble-filled region where pebbles make contact with the side wall.
3. **block vs reflector** - Blocks include the radial reflector outside the 'proper core' and any components therein (dimples, control/safety rods, helium riser channels). Other reflectors are located above and below the radial reflectors and core, but these reflectors are not a part of blocks. The radial reflector is broken into blocks to help simplify model geometry.
4. **adding detectors** - Detectors can be added using the `python SerpentReactor.create_user_detector()` method. Energy divisions for user-made detectors can be created using `SerpentReactor.create_energy_grid()`. These methods can only be called after the SerpentReactor or PebbleSorter objects have been created.
5. **reactor materials** - `Kugelpy` assumes materials fit into one of 9 non-fuel core materials, fuels, or TRISO layer materials.  The 9 core materials are stored in `PebbleSorter.core_materials`, spacially-dependent fuel definitions are stored in `PebbleSorter.equilibrium_materials`, equilibrium fuel is stored in `PebbleSorter.equilibrium_fuel_material` and `PebbleSorter.fuel_material`, and TRISO layer materials are stored in `Pebble.material`. Equilibrium materials, fuel materials, and equilibrium fuel material require user input. The initial fuel definition passed to fuel material will be the start-up fuel composition. TRISO layer material and core materials have default values. core_materials can be changed by the user in the class instance call, but non-fuel material definitions for pebbles/TRISO must be edited in pebble.py directly for run-in/jump-in modeling.
6. **material dictionary formatting** - While other information stored in dictionaries has a function for creating those dictionaries, Serpent materials can contain any number of isotopes so these dictionaries must be passed directly. General material dictionaries are formatted as such: 
```python
    {'zaid_ID_1': weight_density_1, 'zaid_ID_2': weight_density_2, etc.} 
```
Fuel material definitions take these lists directly since fuel temperatures are updated separately, but core materials take additional arguments to account for moderation and temperatures. Core materials are formatted as such:
```python
    {'material_name': {'temperature': float(temperature), 'moder': str(moder_name), 'moder_nuclide': int(moder_nuclide_zaid_ID), 'nuclides': dict(material_dictionary)}}
```
7. **pbed geometries** - Serpent's pbed geometries require a pbed geometry input file containing the x-, y-, and z-coordinates of the pebble as well as the pebble radius and universe name. By default, kugelpy uses a TRISO input file containing 18,775 particles randomly dispersed in a 2.5 centimeter sphere and a pebble geometry input file containing over 220,000 pebbles filling the core region of the GPBR (120 centimeter 'proper core', 55.438 centimeter tall lower conus, and upper cone). The pebble bed geometry input file can be changed using ```PebbleSorter.pebble_bed_name``` and the TRISO geometry input file can be changed using ```PebbleSorter.triso_dist_name```. For cores or pebbles smaller than those used in the GPBR, existing pbed input files can be used but may result in partially cut spheres or particles, which can introduce error in the model.
8. **running on HPCs** - Kugelpy was developed on the INL HPC and is therefore configured to make use of MPI parallel computing. For this reason jobs are submitted using `mpiexec`. When trying to use `perform_run_in` or `perform_jump_in` on HPC services, it is advised that the user submit a job script which runs the Python script. `Kugelpy` will automatically run Serpent jobs after the input files have been generated so long as `one_run==True`. To make sure that `Kugelpy` runs correctly, the user should review the following functions which are used to run Serpent: `SerpentReactor.run_serpent()`, `PebbleBed.write_serpent_pbs()`.
9. **fatal errors** - If issues with fatal errors occur when attempting to run Serpent models, the `nofatal` flag can be set to true which will ignore certain fatal errors.
10. **re-running models with existing files** - If re-running a model either completely or from a pickled save point using `SerpentReactor.loader()`, errors were encountered where existing files were not always over-written by the new run. For this reason, it is recommended that all model files after the starting time step be removed from the working directory.