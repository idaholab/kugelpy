Copyright 2024, Battelle Energy Alliance, LLC, ALL RIGHTS RESERVED
### Overview of Variables in Kugelpy
The following variables either require user input or are likely to be of interest to general users. 

### Inheritance
- PebbleSorter inherits from SerpentReactor
- PebbleBedReactor inherits from SerpentReactor


### ###########################################################################
# ```kugelpy.reactor.SerpentReactor``` #
### ###########################################################################
Class for storing basic reactor data which would be of use to a wide variety of reactor design.

## File management parameters
**output_dir** : str, default: './' \
    Specifies directory where output files will be stored. \
\
**reactor_file_name** : str, default: 'reactor' \
   Specifies name of reactor input file(s). \
\
**one_run** : bool, default: True \
   This parameters determines if the simulations will be perfored in a single pbs/slurm simulation, or if each step will be a unqiue PBS/slurm submission. \
\
**save_state_point** : bool, default: False \
    This parameter determines whether or not pickled save states are produced, which can be used to re-start the model from a specific step/time. \
\
**save_state_point_frequency** : int, default: 10 \
    The value of this parameter determines when a pickled save state is created, if `save_state_point` is True.

## Serpent run parameters
**num_particles** : int, default: 20000 \
    ```Does nothing in SerpentReactor but is inherited by PebbleSorter```. Specifies the number of neutrons per generation for Serpent model. \
\
**num_generations** : int, default: 400 \
    ```Does nothing in SerpentReactor but is inherited by PebbleSorter```. Specifies the number of active generations for Serpent model. \
\
**skipped_generations** : int, default: 40 \
    ```Does nothing in SerpentReactor but is inherited by PebbleSorter```. Specifies the number of innactive generations for Serpent model. \
\
**burnup_optimization_num** : int, default: 1 \
    ```Does nothing in SerpentReactor but is inherited by PebbleSorter```. Specifies the Serpent optimization option for burnup. 

## Reactor component parameters
**xs_dict** : dict, default: {} \
    Stores cross-section data. Key should be an integer for the temperature in Kelvin (K), value is a dictionary; the first key is the material name, the first value is the cross-section library name (ex. `grph1500`); the second key is xs_set, the value is the cross-section library extension (ex. `15c`). \
\
**materials** : dict, default: {} \
    Stores material data. Key should be material name, value should be a dictionary where the key is an isotope/element name and the value is its atomic/weight fraction. \
\
**user_detector_dict**: dict, default: {} \
    Stores user-made detector data. Updated using `SerpentReactor.create_user_detector()`. \
\
**energy_grid_dict**: dict, default: {} \
    Stores energy grids which can be used in detectors. Updated using `SerpentReactor.create_energy_grid`.

### ###########################################################################
# ```kugelpy.kugelpy.pebble_bed_reactor.PebbleBedReactor``` #
### ###########################################################################

**pebble_bed_name** : str, default: 'pf61_Step1.pbed' \
    Name of file containing pebble bed geometry. For pebble bed regions that differ significantly, or for different size pebbles, this variable will need to be the name of the file supplied by the user located in`/kugelpy/kugelpy/data/`. \
\
**core_file_name** : str, default: 'pbr_structure.inp' \
    Name of file that stores the general core structure surfaces and cells generated by `PebbleBedReactor.write_pbr_core()`. \
\
**output_dir** : str, default: '' \
    Name of directory where output files are stored \
\
**create_dimples** : bool, default: True \
    Parameter used to determine whether the reactor will have dimples along the inner wall of the reflector. Dimples serve an important role in pebble flow but have little neutronic worth and introduce additional surfaces which can make the model run slower. \
\
**simple_core** : bool, default: False \
    Parameter used to create a simplified pebble bed model. If this parameter is set to True the model will only include a cylindrical core, radial reflectors/blocks, pebbles, and upper and lower reflectors. \ 
\
**conus_height** : float, default: 70.772 \
    The height in centimeters (cm) of the cone used to create the lower conus (NOT height of conus). Note, 70.772cm gives a conus height of 55.438cm. \
\
**conus_z_offset** : float, default: 0 \
    Vertical position in centimeters (cm) of the bottom of the lower conus. This is determined based on where the bottom of the pebbles are in the pebble file (see `pebble_bed_name`). \
\
**conus_channel_height** : float, default: 85.438 \
    The total height in centimeters (cm) of the actual conus height (NOT cone) plus 30 cm. \
\
**pebble_shoot_radius** : float, default: 26.0 \
    Radius in centimeters (cm) of the pebble chute located below the conus and through the outlet plenum and lower reflector. \
\
**pebble_chute_height** : float, default: 185.1 \
    Height in centimeters (cm) of the pebble chute located at the bottom of the core. \
\
**bottom_reflector_height** : float, default: 58.4 \
    Height in centimeters (cm) of the reflector spanning from the bottom of the reactor to the bottom of the lower plenum. \
\
**outlet_plenum_height** : float, default: 96.7 \
    Height in centimeters (cm) of the lower plenum spanning from the top of the bottom reflector to the bottom of the lower pebble bed support/conus. \
\
**cr_insertion_depth** : float, default: 0.0 \
    Depth of the control rod [centimeters (cm)] into the active core region. At 0.0, conrtrol rods are at the top of the upper conus. A negative value indicates pulling the control rods futher above the conus, positive puts the control rods futher into the core. \
\
**sr_insertion_depth** : float, default: -25.0 \
    Depth of the safety rod [centimeters (cm)] into the active core region. At 0.0, safety rods are at the top of the upper conus. A negative value indicates pulling the safety rods futher above the conus, positive puts the safety rods futher into the core. \
\
**radius_to_cr_center** : float, default: 133 \
    Radius/distance in centimeters (cm) from the center of the core to the center of the control rod cavity. \
\
**control_rod_radius** : float, default: 6.25 \
    Radius in centimeters (cm) of the control and safety rods. \
\
**control_rod_cavity_radius** : float, default: 6.5 \
    Radius in centimeters (cm) of the cavities containing the control and safety rods. \
\
**radius_to_riser_center** : float, default: 178.5 \
    Radius/distance in centimeters (cm) from the center of the core to the center of the helium riser channels. \
\
**riser_radius** : float, default: 8.5 \
    Radius in centimeters (cm) of the helium riser channels. \
\
**cavity_height** : float, default: 45.8 \
    Height in centimeters (cm) of the helium region above the upper conus of the pebble bed. \
\
**top_reflector_height** : float, default: 86.0 \
    Height in centimeters (cm) of the reflector located above the core cavity. \
\
**pebble_inner_radius** : float, default: 2.5 \
    Radius in centimeters (cm) of the fueled matrix region of the pebbles loaded in the core. Currently the value in `Pebble` does not affect the radius printed in Serpent. \
\
**pebble_outer_radius** : float, default: 3.0 \
    Radius in centimeters (cm) of the pebbles loaded in the core. Currently the value in `Pebble` does not affect the radius printed in Serpent. \
\
**pebble_bed_height** : float, default: 893.0 \
    Height in centimeters (cm) of the 'proper core'. This refers to where the pebbles touch the side walls, i.e. does not include the upper or lower conus. \
\
**dimple_axial_offset** : float, default: 20.5 \
    Axial distance between dimples in adjacent blocks. Note, dimples are not included in geometry if `create_dimples` is set to False. \
\
**dimple_radius** : float, default: 17.5 \
    Radius in centimeters (cm) of the cylindrical dimples set in the side of the core wall/reflector inner wall. Note, dimples are not included in geometry if `create_dimples` is set to False. \
\
**dimple_depth** : float, default: 3.0 \
    Depth in centimeters (cm) of the cylindrical dimples set in the side of the core wall/reflector inner wall. Note, dimples are not included in geometry if simple_core is set to True or `create_dimples` is set to False. \
\
**num_dimples** : int, default: 12  \
    The number of cylindrical dimples in a vertical column along the core wall/reflector inner wall. The total number of dimples is `num_dimples`*`number_of_blocks`. \
\
**block_inner_radius** : float, default: 120.0 \
    The inner radius in centimeters of the reflector. The core is assembled in repeating blocks around the 'proper core' region, so block generally refers to the reflector along with other components including dimples, control rods, safety rods, and helium riser channels. \
\
**block_outer_radius** : float, default: 206.6 \
    The outer radius in centimeters (cm) of the reflector. The core is assembled in repeating blocks around the 'proper core' region, so block generally refers to the reflector along with other components including dimples, control rods, safety rods, and helium riser channels. \
\
**pebble_bed_dimple_radius** : float, default: block_inner_radius + dimple_depth \
    ```Note, changed dimple_radius to dimple_depth -> check tests``` Distance from the core centerline to the outer face of a dimple in centimeters (cm). \
\
**number_of_blocks** :int, default: 18 \
    This parameter determines the number of blocks used to generate the radial reflector region located outside the 'proper core', which exludes the upper cone and lower conus. Each block contains a control rod or safety rod, helium riser channel, and column of dimples. Therefore the number of control rods, helium riser channels, and dimples are changed by changing this value. 

### ###########################################################################
# ```kugelpy.kugelpy.pebble_sorter.PebbleSorter``` #
### ###########################################################################
**graphite_height** :  float, default: 0.0 \
    Initial height in centimeters (cm) for graphite pebble region, all pebbles with centroids below this height will be graphite. \
\
**graphite_fraction** : float, default: 0.0 \
    Fraction of pebbles above the `graphite_height` which are graphite pebbles. \
\
**day_limit** : int, default: 10000 \
    Maximimum number of days modeled (sum of all daysteps). If `efdp_tracker` is greater than this value the simulation ends. \
\
**critical_timestep** : int, default: 1 # Should be selected automatically \
    Keeps track of which burn/time step was selected as a starting point for the next model. Note, while several daysteps are performed for each model the next time step does not necessarily occur after the final step. See `target_keff`. \
\
**power_level** : float, default: 1E+6 \
    Power level of the reactor in Watts (W). \
\
**create_dimples** : bool, default: True \
    This parameter can be used to include dimples in the reactor geometry if set to True. \
\
**simple_core** : bool, deafult: False \
    This parameter can be used to generate a simplified core if set to True. \
\
**serpent_version** : str, default: '2.2' \
    Specifies the Serpent version being used to run the simulation. \
\
**random_seed** : int, default: 2 \
    Seed used for randomization, can be used for reproducibility. 

**create_temperature_profile_flag** : bool, default: False \
    Parameter used to instruct the run-in simulation to create a new temperature distribution after each timestep if set to True. \
\
**temperature_axial_zones** = None \
    If a temperature distribution (`create_temperature_profile_flag=True`) is being used, this fixes the number of axial temperature zones. \
\
**axial_heights** = None \
    A list of heights if the user wants to manually set the temperature profile, otherwise the core is split even axially when `create_temperature_profile_flag=True`. \
\
**max_fuel_temperature** : float, default: None \
    Maximum temperature of the fuel in Kelvin (K), this will occur at the bottom of the core. Only used `create_temperature_profile_flag=True`.  \
\
**min_fuel_temperature** : float, default: None \
    Minimum temperature of the fuel in Kelvin (K),this will occur at the top of the core. Only used `create_temperature_profile_flag=True`.  \
\
**max_pebble_temperature** : float, default: None \
    Maximum temperature of all pebbles (non fuel) in Kelvin (K),this will occur at the top of the core. Only used `create_temperature_profile_flag=True`. \
\
**min_pebble_temperature** : float, default: None \
    Minimum temperature of all pebbles (non fuel) in Kelvin (K),this will occur at the top of the core. Only used `create_temperature_profile_flag=True`.  \
\
**fixed_reactor_temperature** : float, default: 900.0 \
    'Homogenized' reactor temperature in Kelvin (K). Used for core_scattering_library and core_xs_library. \
\
**fuel_temperature** : float, default: fixed_reactor_temperature \
    'Homogenized' fuel temperature in Kelvin (K). \
\
**pebble_temperature** : float, default: fixed_reactor_temperature \
    'Homogenized' pebble (graphite only) temperature in Kelvin (K). \
\
**core_inlet_temperature** : float, default: fixed_reactor_temperature \
    'Homogenized' core inlet temperature in Kelvin (K). \
\
**core_outlet_temperature** : float, default: fixed_reactor_temperature \
    'Homogenized' core outlet temperature in Kelvin (K). \
\
**cr_insertion_depth** : float, default: 0.0 \
    See `PebbleSorter`. \
\
**sr_insertion_depth** : float, default: -25.0 \
    See `PebbleSorter`

## Transition to Equilibrium Core Parameters
**automatic_fuel_transition** : bool, default: True \
    Parameter used, if True, to change `transition_fuel_flag` to True if `graphite_fraction` is less than 1% of the total number of pebbles in the core. \
\
**transition_fuel_flag** : bool, default: False \
    Parameter used, if True, to switch from start-up fuel to equilibrium fuel.
    
## Burnup Parameters
**refine_burnstep** : bool, default: False \
    If True, permits a shortened time step to achieve an appropriate keff. This will cut the first depletion step by four and two, and the simulation will be rerun. \
\
**depletion_steps** : list, default: [11] \
    List of floats corresponding to depletion steps (in days) of the model. \
\
**temp_depletion_steps** : list, default: [1] \
    List of floats used to store refined depletion steps (in days) should the depletion steps need to be refined, indicated by `refine_burnstep` being True \
\
**target_keff** : float, default = 1.005 \
    k-eff value used to determine which burnstep should be used for the next step. The final burnstep should be as close to target_keff as possible without going below `allowable_keff`. Also used for critical height calculations. \
\
**allowable_keff** : float, default: 1.0025 \
    Minimum k-eff value permitted for the start of the next depletion step. \
\
**burnup_limit** : float, default: 160.0 \
    Maximum burnup permitted for a pebble in MWd/kg. Currently pebble reloading is not determined using burnup. \
\
**pass_limit** : int, default: 6 \
    Maximum number of passes through the core a pebble can undergo before it is discharged. \
\
**fuel_material** : dict, default: None \
    Dictionary containing material definition of initial/start-up fuel. \
\
**equilibrium_fuel_material** : dict, default: None \
    Dictionary containing material definition of fresh equilibrium fuel. \
\
**pebble_distribution_file** : str, default: 'pebble_distribution' \
    Name of Serpent input file containing pebble location and universe names. \
\
**pebble_surface_file** : str, default: pebble_surfaces.inp' \
    Name of Serpent input file containing pebble surfaces/pebble bed geometries. \
\
**pebble_material_file** : str, deafult: 'pebble_materials.inp' \
    Name of Serpent input file containing material definitions for pebbles. \
\
**pebble_cell_file** : str, default: 'pebble_cells.inp' \
    Name of Serpent input file containing pebble/pebble bed cell definitions. \
\
**reactor_file_name** : str, default: 'serpent.inp' \
    Name of Serpent input file containing Serpent model parameters which are not detector, surface, cell, or material related. Contains general model information. \
\
**detector_file** : str, default: 'material_detectors.inp' \
    Name of Serpent input file containing automated and user-made detectors and energy grids. \
\
**keep_files** : bool, default: True \
    Parameter used, if True, to save input files after a step/model is competed. \
\
**start_step** : int, default: 1 \
    Used to compare to step to ensure that the model isn't starting on the wrong step/doesn't re-run steps. \
\
**load_step** : int, default: 1 \
    Stores the current step of the run-in model. \
\
**homogenize_passes** : bool, default: True \
    This flag homogenizes pebbles after they are discharged from the core. Upon discharge, pebbles of each fuel type and pass number are gathered, and the materials of these pebbles are homogenized by using volume averaging to account for the different number of pebbles being discharge from each volume. This prevents an increasing number of pebble types. If this is set to False, pebbles will be tracked on an individual basis; this will result in thousands of materials, surfaces, and cells ensure enough memory is present to allow for this simulation. \
\
**core_materials** : dict, default: {'control_rod': \
  {'temperature': 300.0, 'moder':       'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 2.74680E-2, '5010': 8.799626E-2, '5011': 2.18617E-2}}, \
                        'safety_rod':     {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 2.74680E-2, '5010': 8.799626E-2, '5011': 2.18617E-2}}, \
                        'reflector':      {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 8.82418E-2, '5010': 9.42800E-8,  '5011': 3.79489E-7}}, \
                        'outlet_channel': {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 6.61814E-2, '5010': 7.07100E-8,  '5011': 2.84617E-7}}, \
                        'outlet_plenum':  {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 5.82396E-2, '5010': 6.22248E-8,  '5011': 2.50463E-7}}, \
                        'pebble_shoot':   {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 8.82418E-2, '5010': 7.07100E-8,  '5011': 2.84617E-7}}, \
                        'pebshell':       {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 6.61814E-2, '5010': 2.23273E-8,  '5011': 9.04368E-7}}, \
                        'graphite':       {'temperature': 300.0, 'moder': 'moder', 'moder_nuclide': 6000, 'nuclides':{ '6000': 8.67416E-2, '5010': 2.23273E-8,  '5011': 9.04368E-7}}, \
                        'helium':         {'temperature': 300.0, 'moder': '',      'moder_nuclide': '',   'nuclides':{ '2004': 5.28437E-4}}} \
    Contains non-fuel material definitions for the reactor, not including pebbles. \
\
**triso_dist_name** : str, default: 'triso_7grHM_1.triso' \
    Name of file contain triso particle geometry. This geometry is used repeatedly for all pebbles in the core. \
\
**output_dir** : str, default: './' \
    Path and name of directory where output files will be saved. \
\
**template_files** : str, default: ['serpent.pbs'] \
    Names of files that can be copied over from existing files instead of rewritten. \
\
**equilibrium_core** : bool, default: False \
   This is used to create a core with pebbles that can be assigned to each axial zone, allowing for jump-in to equilibrium calculation or for startup fuel to artificially be given a pass number. \
\
**equilibrium_materials** : dict, default: None \
    materials to be assigned to each axial zone as required if `equilibrium_core=True`. \
\
**volume_powers** : dict, default: {} \
    Dictionary containing the powers for pebble type and pass in an axial volume. \
\
**fuel_temperature_profile** : dict, default: None \
    Contains zonal temperatures in Kelvin (K) of fuel assuming a linear temperature rise through the core. \
\
**pebble_temperature_profile** : dict, default: None \
    Contains zonal temperatures in Kelvin (K) of pebbles (```just graphite```) assuming a linear temperaure rise through the core. \
\
**run_in_steps** : dict, default: {} \
    Dictionary of the steps desired for manipulating the time-dependent PBR problem. \
\
**lost_pebbles** : int, deafult: = 0 \
    Used to keep track of the number of pebbles which are removed from the last axial zone due to mismatch in the number of pebbles in axial zones.\
\
**current_efpd** : float, default: 0 \
    Used to keep track of the effective full power days of the reactor. \
\
**steps** : int, default: 10 \
    Desired number of time steps to take, can be overridden by day_limit. \
\
**allow_sub_crit_flag** : bool, default: False \
    If True, allows code to pick depletion steps which resulted in sub-critical state for the next step. \
\
**final_pass_limit** : int, default: pass_limit \
    Maximum number of passes for equilibrium fuel. \
\
**final_homogenization_group** : int, default: homogenization_group \
    Maximum number of homogenization groups.

## Generation of critical height parameters
**critical_keff_tolerance** : float, default: 0.0005 \
    Acceptable difference between k effectives of two models with different heights. If keff is less than critical_keff_tolerance between two iterations then the critical configuration has been found . \
\
**critical_height_fractions** : list, default: [0.25,0.5,0.75] \
    Selection cases for core height when searching for critical height. Each value in the list will correspond to a Serpent run with that fraction of the core filled with the mixture of graphite and fuel.

### Reactor geometry
**pebble_bed_radius** : float, default: 120.0 \
    Radius of the 'proper core' region in centimeters (cm). \
\
**pebble_bed_height** : float, default: 893.0 \
    Height of the 'proper core' region in centimeters (cm). \
\
**discharge_chute_radius** : float, default: 24.0 \
    Radius of the pebble chute located at the bottom of the core in centimeters (cm). \
\
**pebble_bed_axial_offset** : float, default: 170.0 \
    Axial offset of the pebble bed pebble geometry in centimeters (cm). \
\
**one_run** : bool, default: True \
    Execute the run-in or approach to equilibrium in a single run (i.e. run each Serpent simulation with the current terminal) if set to True. If set to False, each Serpent run will be submitted via a separate pbs/slurm submission file. \
\
**burnup_flag** bool, default: False \
    Create a reference burnup scheme for `burnup_limit=150` and `pass_limit=15`.


